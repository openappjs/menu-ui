#!/usr/bin/env node

var beefy = require('beefy');
var fs = require('fs');
var swig = require('swig');

var express = require('express');

var component = require('../package.json').name;

var examples = fs.readdirSync(__dirname + '/../examples')
.filter(function (name) {
  // example directories are all except names ending in .swig
  return (name.substring(name.length - 5, name.length) !== '.swig');
})
;

var app = express();

//
// html indexes
//

// setup template rendering
app.engine('swig', swig.renderFile);
app.set('view engine', 'swig');
app.set('views', __dirname + '/../examples');

app.get('/', function (req, res) {
  res.render('index.swig', {
    component: component,
    examples: examples,
  });
})

//
// js bundles
//

// get entries
var entries = {};
examples.forEach(function (name) {
  entries['/examples/' + name + '/bundle.js'] =
    __dirname + "/../examples/" + name + "/app.js";
});
// use beefy as live bundler
app.use(beefy({
  entries: entries,
  debug: true,
  live: true,
}));

app.listen(5000);
